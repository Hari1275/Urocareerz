# Story 1.4: Admin Dashboard & Moderation

## Status
Draft

## Story
**As an** admin,
**I want** to manage users, moderate content, and oversee platform operations,
**so that** I can ensure platform quality, security, and compliance

## Acceptance Criteria
1. Admin can access a dedicated dashboard with platform overview
2. Admin can view and approve/reject new user registrations
3. Admin can assign and change user roles (mentee, mentor, admin)
4. Admin can review and approve/reject opportunity submissions
5. Admin can view and manage all opportunities with bulk actions
6. Admin can flag and remove inappropriate content
7. Admin can view platform analytics (user count, post count, engagement)
8. Admin can access complete audit logs of user and admin actions
9. Admin can manage legal disclaimer and terms agreement
10. Admin can send system announcements to users
11. Admin can view user profiles and activity history
12. Admin can export platform data for reporting purposes

## Tasks / Subtasks
- [ ] Task 1: Create admin authentication and authorization (AC: 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12)
  - [ ] Implement admin role verification middleware
  - [ ] Create admin-only route protection
  - [ ] Add admin session management
  - [ ] Implement admin activity logging
- [ ] Task 2: Build admin dashboard API endpoints (AC: 1, 7, 8, 12)
  - [ ] GET /api/admin/dashboard - Platform overview and analytics
  - [ ] GET /api/admin/users - List all users with filters
  - [ ] GET /api/admin/opportunities - List all opportunities with filters
  - [ ] GET /api/admin/audit-logs - Retrieve audit logs with filters
  - [ ] GET /api/admin/analytics - Detailed platform analytics
  - [ ] POST /api/admin/export - Export platform data
- [ ] Task 3: Implement user management functionality (AC: 2, 3, 11)
  - [ ] PUT /api/admin/users/[id]/approve - Approve user registration
  - [ ] PUT /api/admin/users/[id]/reject - Reject user registration
  - [ ] PUT /api/admin/users/[id]/role - Change user role
  - [ ] GET /api/admin/users/[id] - Get detailed user information
  - [ ] DELETE /api/admin/users/[id] - Deactivate user account
  - [ ] Implement bulk user operations
- [ ] Task 4: Create content moderation system (AC: 4, 5, 6)
  - [ ] PUT /api/admin/opportunities/[id]/approve - Approve opportunity
  - [ ] PUT /api/admin/opportunities/[id]/reject - Reject opportunity
  - [ ] PUT /api/admin/opportunities/[id]/flag - Flag inappropriate content
  - [ ] DELETE /api/admin/opportunities/[id] - Remove opportunity
  - [ ] Implement bulk opportunity operations
  - [ ] Add admin feedback and notes system
- [ ] Task 5: Build admin dashboard UI components (AC: 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11)
  - [ ] Create admin dashboard layout and navigation
  - [ ] Build platform overview dashboard with key metrics
  - [ ] Create user management interface with approval workflow
  - [ ] Build opportunity moderation interface with bulk actions
  - [ ] Create audit log viewer with filtering and search
  - [ ] Implement analytics dashboard with charts and graphs
  - [ ] Create system announcement interface
  - [ ] Build data export functionality
- [ ] Task 6: Implement analytics and reporting (AC: 7, 8, 12)
  - [ ] Create analytics data aggregation system
  - [ ] Implement user engagement tracking
  - [ ] Build opportunity performance metrics
  - [ ] Create audit log analysis and reporting
  - [ ] Implement data export functionality (CSV, JSON)
  - [ ] Add real-time dashboard updates
- [ ] Task 7: Add legal and compliance features (AC: 9, 10)
  - [ ] Create legal disclaimer management system
  - [ ] Implement terms agreement tracking
  - [ ] Build system announcement system
  - [ ] Add compliance reporting features
  - [ ] Implement data retention policies

## Dev Notes

### Previous Story Insights
From Story 1.1 (User Authentication Setup):
- Authentication system provides secure session management
- JWT tokens include user role information
- Audit logging system is in place for tracking actions

From Story 1.2 (User Profile Creation):
- Profile model includes role-specific fields
- User data structure is well-defined

From Story 1.3 (Opportunity/Job Board):
- Opportunity model includes admin approval fields
- Application system provides user activity data
- Admin feedback and notes system is referenced

### Data Models
Based on the architecture document, the admin system should leverage existing models:

**AuditLog Model (already exists):**
- `id: ObjectId` (Primary Key)
- `action: String` (CREATE, UPDATE, DELETE, APPROVE, etc.)
- `entityType: String` (USER, OPPORTUNITY, APPLICATION, etc.)
- `entityId: String` (ID of affected entity)
- `userId: ObjectId` (User performing action)
- `metadata: Json` (Additional context)
- `ipAddress: String`, `userAgent: String`
- `createdAt: DateTime`
- Indexes on action, entityType, userId, createdAt

**User Model (extend existing):**
- Add admin-specific fields if needed
- Leverage existing role field for admin identification

**Opportunity Model (extend existing):**
- Leverage existing adminFeedback, adminNotes fields
- Use existing status field for approval workflow

[Source: ARCHITECTURE_DOCUMENT.md#3.1 Schema Design]

### API Specifications
Admin management endpoints to implement:
- `GET /api/admin/dashboard` - Platform overview and key metrics
- `GET /api/admin/users` - List users with pagination and filters
- `PUT /api/admin/users/[id]/approve` - Approve user registration
- `PUT /api/admin/users/[id]/reject` - Reject user registration
- `PUT /api/admin/users/[id]/role` - Change user role
- `GET /api/admin/opportunities` - List opportunities with admin filters
- `PUT /api/admin/opportunities/[id]/approve` - Approve opportunity
- `PUT /api/admin/opportunities/[id]/reject` - Reject opportunity
- `GET /api/admin/audit-logs` - Retrieve audit logs with filters
- `GET /api/admin/analytics` - Detailed platform analytics
- `POST /api/admin/announcements` - Send system announcements
- `POST /api/admin/export` - Export platform data

[Source: ARCHITECTURE_DOCUMENT.md#5.1 Route Structure]

### Component Specifications
Admin UI components needed:
- Admin dashboard layout with navigation sidebar
- Platform overview cards with key metrics
- User management table with approval actions
- Opportunity moderation interface with bulk operations
- Audit log viewer with advanced filtering
- Analytics dashboard with charts (Recharts integration)
- System announcement form and history
- Data export interface with format selection
- Admin settings and configuration panel

[Source: ARCHITECTURE_DOCUMENT.md#6.2 State Management Strategy]

### File Locations
Based on the existing project structure:
- API routes: `src/app/api/admin/`
- UI components: `src/components/admin/`
- Database models: `prisma/schema.prisma` (leverage existing)
- Admin utilities: `src/lib/admin.ts`
- Analytics utilities: `src/lib/analytics.ts`
- Export utilities: `src/lib/export.ts`

[Source: ARCHITECTURE_DOCUMENT.md#6.1 Component Structure]

### Testing Requirements
- Unit tests for admin authorization logic
- Integration tests for admin API endpoints
- Component tests for admin dashboard components
- Security tests for admin access control
- E2E tests for admin workflow scenarios
- Performance tests for analytics and reporting
- Test file location: `__tests__/` or `src/__tests__/`

[Source: ARCHITECTURE_DOCUMENT.md#10.1 Performance Optimizations]

### Technical Constraints
- Use Next.js 15.4.1 with React 19.1.0
- MongoDB with Prisma ORM (leverage existing schema)
- Role-based access control (ADMIN role required)
- Audit logging for all admin actions
- Real-time analytics with data aggregation
- Secure data export functionality
- Responsive admin interface design
- Performance optimization for large datasets

[Source: ARCHITECTURE_DOCUMENT.md#2.2 Technology Stack]

### Testing
**Testing Standards from Architecture:**
- Test file location: `__tests__/` directory
- Test standards: Unit tests for business logic, integration tests for API endpoints
- Testing frameworks: Jest with React Testing Library
- Specific testing requirements: Admin authorization testing, audit logging verification, analytics accuracy testing

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-05 | 1.0 | Initial story creation | Bob (SM) |

## Dev Agent Record

### Agent Model Used
TBD

### Debug Log References
TBD

### Completion Notes List
TBD

### File List
TBD

## QA Results
TBD 